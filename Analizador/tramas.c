#include<stdio.h>

int trama(unsigned char T[]);
void checkSUM(unsigned char T[], unsigned short int iniT, unsigned short int finT, unsigned short int posXN, int chFlag);
void commonPort(unsigned short int portA);
void checkSUMud(unsigned char T[], unsigned short int iniT);

int main()
{
		//unsigned char T[] = {0x00,0x02,0xb3,0x9c,0xae,0xba,0x00,0x02,0xb3,0x9c,0xdf,0x1b,0x00,0x03,0xf0,0xf0,0x01,0x01};
		unsigned char T[][200]={{  //t1
			0x00,0x1f,0x45,0x9d,0x1e,0xa2,0x00,0x23,0x8b,0x46,0xe9,0xad,0x08,0x00,0x46,0x00, /* TRAMA c */
		 0x80,0x42,0x04,0x55,0x34,0x11,0x80,0x11,0x6b,0xf0,0x94,0xcc,0x39,0xcb,0x94,0xcc, 
		 0x67,0x02,0xaa,0xbb,0xcc,0xdd,0x04,0x0c,0x00,0x35,0x00,0x2e,0x85,0x7c,0xe2,0x1a,
		 0x01,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x77,0x77,0x77,0x03,0x69,
		 0x73,0x63,0x05,0x65,0x73,0x63,0x6f,0x6d,0x03,0x69,0x70,0x6e,0x02,0x6d,0x78,0x00,
		 0x00,0x1c,0x00,0x01                                
			},

			{  //t2
			0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x08, 0x06, 0x00, 0x01, 
			0x08, 0x00, 0x06, 0x04, 0x00, 0x02, 0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x94, 0xcc, 0x39, 0xfe, 
			0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x94, 0xcc, 0x39, 0xcb, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                          
			},
			{  //t3
			0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x08, 0x00, 0x46, 0x00, 
			0x80, 0x42, 0x04, 0x55, 0x34, 0x11, 0x80, 0x11, 0x6b, 0xf0, 0x94, 0xcc, 0x39, 0xcb, 0x94, 0xcc, 
			0x67, 0x02, 0xaa, 0xbb, 0xcc, 0xdd, 0x04, 0x0c, 0x00, 0x35, 0x00, 0x2e, 0x85, 0x7c, 0xe2, 0x1a, 
			0x01, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x77, 0x77, 0x77, 0x03, 0x69, 
			0x73, 0x63, 0x05, 0x65, 0x73, 0x63, 0x6f, 0x6d, 0x03, 0x69, 0x70, 0x6e, 0x02, 0x6d, 0x78, 0x00, 
			0x00, 0x1c, 0x00, 0x01                          
			},
			{  //t4
			0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x04, 0xf0, 0xf1, 
			0x09, 0x8d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7c, 0x9b, 0x6d  
			},
			{  //t5
			0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x08, 0x06, 0x00, 0x10, 
			0x08, 0x00, 0x06, 0x04, 0x00, 0x03, 0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x94, 0xcc, 0x39, 0xcb, 
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x94, 0xcc, 0x3a, 0xe1                                      
			},
			{  //t6
			0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x08, 0x06, 0x00, 0x10, 
			0x08, 0x00, 0x06, 0x04, 0x00, 0x04, 0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x94, 0xcc, 0x3a, 0xe1, 
			0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x94, 0xcc, 0x39, 0xcb, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00                         
			},
			{  //t7
			0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x08, 0x00, 0x45, 0x00, 
			0x00, 0x6f, 0x90, 0x30, 0x40, 0x00, 0xfb, 0x11, 0x24, 0xe7, 0x94, 0xcc, 0x67, 0x02, 0x94, 0xcc,// 
			0x39, 0xcb, 0x00, 0x35, 0x04, 0x0c, 0x00, 0x5b, 0xe8, 0x60, 0xe2, 0x1a, 0x85, 0x80, 0x00, 0x01, 
			0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x03, 0x77, 0x77, 0x77, 0x03, 0x69, 0x73, 0x63, 0x05, 0x65, 
			0x73, 0x63, 0x6f, 0x6d, 0x03, 0x69, 0x70, 0x6e, 0x02, 0x6d, 0x78, 0x00, 0x00, 0x1c, 0x00, 0x01, 
			0xc0, 0x14, 0x00, 0x06, 0x00, 0x01, 0x00, 0x00, 0x0e, 0x10, 0x00, 0x21, 0x04, 0x64, 0x6e, 0x73, 
			0x31, 0xc0, 0x1a, 0x03, 0x74, 0x69, 0x63, 0xc0, 0x1a, 0x77, 0xec, 0xdf, 0x29, 0x00, 0x00, 0x2a, 
			0x30, 0x00, 0x00, 0x0e, 0x10, 0x00, 0x12, 0x75, 0x00, 0x00, 0x00, 0x2a, 0x30                    
			},
			{  //t8
			0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x08, 0x00, 0x45, 0x00, 
			0x00, 0x42, 0x04, 0x56, 0x00, 0x00, 0x80, 0x11, 0x6b, 0xef, 0x94, 0xcc, 0x39, 0xcb, 0x94, 0xcc, 
			0x67, 0x02, 0x04, 0x0c, 0x00, 0x35, 0x00, 0x2e, 0xff, 0x87, 0x68, 0x2a, 0x01, 0x00, 0x00, 0x01, 
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x77, 0x77, 0x77, 0x03, 0x69, 0x73, 0x63, 0x05, 0x65, 
			0x73, 0x63, 0x6f, 0x6d, 0x03, 0x69, 0x70, 0x6e, 0x02, 0x6d, 0x78, 0x00, 0x00, 0x01, 0x00, 0x01  
			},
			{  //t9
			0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x08, 0x00, 0x45, 0x00, 
			0x00, 0x3c, 0x04, 0x57, 0x00, 0x00, 0x80, 0x01, 0x98, 0x25, 0x94, 0xcc, 0x39, 0xcb, 0x94, 0xcc, 
			0x3a, 0xe1, 0x08, 0x00, 0x49, 0x5c, 0x03, 0x00, 0x01, 0x00, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 
			0x67, 0x68, 0x69, 0x6a, 0x6b, 0x6c, 0x6d, 0x6e, 0x6f, 0x70, 0x71, 0x72, 0x73, 0x74, 0x75, 0x76, 
			0x77, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 0x67, 0x68, 0x69                                      
			},
			{  //t10
			0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x08, 0x00, 0x45, 0x00, 
			0x00, 0x3c, 0x01, 0xb5, 0x00, 0x00, 0x3f, 0x01, 0xdb, 0xc7, 0x94, 0xcc, 0x3a, 0xe1, 0x94, 0xcc, 
			0x39, 0xcb, 0x00, 0x00, 0x51, 0x5c, 0x03, 0x00, 0x01, 0x00, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 
			0x67, 0x68, 0x69, 0x6a, 0x6b, 0x6c, 0x6d, 0x6e, 0x6f, 0x70, 0x71, 0x72, 0x73, 0x74, 0x75, 0x76, 
			0x77, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 0x67, 0x68, 0x69                                      
			},
			{  //t11
			0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x00, 0x1c, 0xc0, 0x7b, 0x35, 0xa1, 0x08, 0x00, 0x48, 0x00,  
			0x00, 0x48, 0x5c, 0x7d, 0x00, 0x00, 0x80, 0x01, 0x6c, 0x88, 0x94, 0xcc, 0x39, 0xc3, 0x94, 0xcc, 
			0x00, 0x49, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x06, 0x05, 0x04, 0x03, 0x02, 0x01, 0x08, 0x00, 
			0x3b, 0x5c, 0x02, 0x00, 0x10, 0x00, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 0x67, 0x68, 0x69, 0x6a, 
			0x6b, 0x6c, 0x6d, 0x6e, 0x6f, 0x70, 0x71, 0x72, 0x73, 0x74, 0x75, 0x76, 0x77, 0x61, 0x62, 0x63, 
			0x64, 0x65, 0x66, 0x67, 0x68, 0x69              
			},
			{  //t12
			0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x80, 0x35, 0x00, 0x01, 
			0x08, 0x00, 0x06, 0x04, 0x00, 0x03, 0x00, 0x1f, 0x45, 0x9d, 0x1e, 0xa2, 0x94, 0xcc, 0x3a, 0xe1, 
			0x00, 0x23, 0x8b, 0x46, 0xe9, 0xad, 0x94, 0xcc, 0x39, 0xcb, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xd8, 0xee, 0xdf, 0xb0  
			},
			{ //t13
			0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x03, 0xf0, 0xf0, 
			0x53, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x43, 0x05, 0x90, 0x6d  
			},
			{  //t14
			0x02, 0xff, 0x53, 0xc3, 0xe9, 0xab, 0x00, 0xff, 0x66, 0x7f, 0xd4, 0x3c, 0x08, 0x00, 0x45, 0x00, 
			0x00, 0x30, 0x2c, 0x00, 0x40, 0x00, 0x80, 0x06, 0x4b, 0x74, 0xc0, 0xa8, 0x01, 0x02, 0xc0, 0xa8, 
			0x01, 0x01, 0x04, 0x03, 0x00, 0x15, 0x00, 0x3b, 0xcf, 0x44, 0x00, 0x00, 0x00, 0x00, 0x50, 0x20, 
			0x20, 0x00, 0x0c, 0x34, 0x00, 0x00, 0x02, 0x04, 0x05, 0xb4, 0x01, 0x01, 0x04, 0x02              
			},
			{  //t15
			0x00, 0xff, 0x66, 0x7f, 0xd4, 0x3c, 0x02, 0xff, 0x53, 0xc3, 0xe9, 0xab, 0x08, 0x00, 0x45, 0x00, 
			0x00, 0x30, 0x05, 0xc4, 0x40, 0x00, 0x80, 0x06, 0x71, 0xb0, 0xc0, 0xa8, 0x01, 0x01, 0xc0, 0xa8, 
			0x01, 0x02, 0x00, 0x15, 0x04, 0x03, 0x21, 0x5d, 0x3a, 0x44, 0x00, 0x3b, 0xcf, 0x45, 0x70, 0x12, 
			0x44, 0x70, 0x8c, 0x11, 0x00, 0x00, 0x02, 0x04, 0x05, 0xb4, 0x01, 0x01, 0x04, 0x02              
			},
			{  //t16
			0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x12, 0xf0, 0xf0, 
			0x0a, 0x0b, 0x0e, 0x00, 0xff, 0xef, 0x14, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x7f, 0x23,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x99, 0x98, 0x6d  
			},
			{ //t17
			0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x03, 0xf0, 0xf1, 
			0x53, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x43, 0x05, 0x90, 0x6d  
			},
			{ //t18
			0x00, 0x02, 0xb3, 0x9c, 0xae, 0xba, 0x00, 0x02, 0xb3, 0x9c, 0xdf, 0x1b, 0x00, 0x03, 0xf0, 0xf0, 
			0x43, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x43, 0x05, 0x90, 0x6d  
			}};
	
	unsigned char i;
	
	for(i=0 ; i<18 ; i++)
	{
		printf("\n\n##Trama: %d\n", i+1);
		trama(T[i]);

	}
}
	
	int trama(unsigned char T[])
	{
		unsigned char TamIP,aux;
		unsigned char TamTCP;
		unsigned short tot = T[12] << 8 | T[13];
		unsigned char S[][5] = {"RR","RNR","REJ","SREJ"};
		char UC[][6] = {"UI","SIM"," ","SARM","UP"," "," ","SABM","DISC"," "," ","SARME"," "," "," ","SABME","SNRM"," "," ","RSET"," "," "," ","XID"," "," "," ","SNRME"};
		char UR[][5] =  {"UI","RIM"," ","DM"," "," "," "," ","RD"," "," "," ","UA",""," "," "," ","FRMR "," "," "," "," "," ","XID"," "," "," "," "};
		
		
		printf("\n\n.:: Cabecera Ethernet ::.");
		printf("\n\nMAC Destino: %.2x:%.2x:%.2x:%.2x:%.2x:%.2x",T[0],T[1],T[2],T[3],T[4],T[5]);
		printf("\n\nMAC Origen: %.2x:%.2x:%.2x:%.2x:%.2x:%.2x",T[6],T[7],T[8],T[9],T[10],T[11]);
		
		
		if(tot <= 1500)
		{
			printf("\n\nTamanio: %d bytes",tot);
			//printf("\n\nTipo LLC");
			printf("\n\n.:: Cabecera LLC ::.");
		}
		
		
		
		/*else if(tot == 2048)
		{
			printf("\n\nTipo IP");
			printf("\n\n.:: Cabecera IP ::.");
		}*/
		else if (tot==2048)
		{
			printf("\n\nTipo IP: %d bytes", tot);
			printf("\n\n.:: Cabecera IP ::.");
			TamIP = (T[14]&15)*4;
			printf("\n\nVersion: %d", T[14]>>4);
			printf("\n\nIHL (Internet Header Lenght): %d bytes", (T[14]&15)*4 );
			if( ((T[14]&15)*4) < 20 && ((T[14]&15)*4) > 60 )
			printf("\n\nTipo de servicio: ");
			if(T[15]&16)
				printf("Minimize Delay\n");
			else if(T[15]&8)
				printf("Maximize Throughout\n");
				else if(T[15]&4)
					printf("Maximize Reliability\n");
					else if(T[15]&2)
						printf("Minimize Cost\n");
						else if(T[15]&1)
							printf("Reserved and set to 0\n");
							else printf("\n");
			printf("\nLongitud total: %d bytes", (T[16]<<8)|T[17]);
			if( ((T[16]<<8) | T[17])>65535 )
			printf("\n\nIdentificacion: %d", ((T[18]<<8)|T[19]));
			printf("\n\nFlags: ");
			if((T[20]&64))
			printf("Don't Fragment");
			if((T[20]&32))
			printf("More Fragment");
			printf("\n\nFragment Offset: %d unidades de 8 bytes", (T[20]&31)<<8 | T[21]);
			printf("\n\nTime to live: %d saltos", T[22]);
			printf("\n\nProtocolo: ");
			switch(T[23]){
				case 1:
				printf("ICMP\n");
				break;
				case 2:
				printf("IGMP\n");
				break;
				case 6:
				printf("TCP\n");
				break;
				case 9:
				printf("IGRP\n");
				break;
				case 17:
				printf("UDP\n");
				break;
				case 47:
				printf("GRE\n");
				break;
				case 50:
				printf("ESP\n");
				break;
				case 51:
				printf("AH\n");
				break;
				case 57:
				printf("SKIP\n");
				break;
				case 88:
				printf("EIGRP\n");
				break;
				case 89:
				printf("OSPF\n");
				break;
				case 115:
				printf("L2TP\n");
				break;
			}
			printf("\nHeader Checksum:");
			checkSUM(T,14,(14 + TamIP -1), 24,0);
			printf("\n\nDireccion Origen: %d.%d.%d.%d", T[26],T[27],T[28],T[29]);
			printf("\n\nDireccion Destino: %d.%d.%d.%d", T[30],T[31],T[32],T[33]);
			if((14 + TamIP - 1) > 33){
				printf("\n\nOpciones: ");
				switch ( (T[34]<<24) | (T[35]<<16) | (T[36]<<8) | (T[37])) {
					case 0:
					printf("End of the Option list\n");
					break;
					case 1:
					printf("No operation (pad)\n");
					break;
					case 7:
					printf("Record route\n");
					break;
					case 68:
					printf("Timestamp\n");
					break;
					case 131:
					printf("Loose source route\n");
					break;
					case 137:
					printf("Strict source route\n");
					break;
					default:
					printf("%04x\n",(T[34]<<24) | (T[35]<<16) | (T[36]<<8) | (T[37]));
					break;
				}
			}
			switch(T[23]){
				case 1:
					printf("\n\n.:: Cabecera ICMP ::.");
					printf("\n\nTipo: %d => ", T[14 + TamIP]);
					switch (T[14 + TamIP]) 
					{
						case 0:
							printf("Echo Replay");
							break;
						case 3:
							printf("Destination Unreachable");
							break;
						case 4:
							printf("Source Quench");
							break;
						case 5:
							printf("Redirect");
							break;
						case 8:
							printf("Echo");
							break;
					}
					printf("\n\nCodigo: %d ", T[14 + TamIP + 1]);
					printf("\n\nChecksum: %04x \n ", T[14 + TamIP + 2]);
					return 0;
					break;

				case 6:
					TamTCP=(T[14 + TamIP+12]>>4)*4;
					printf("\n\n.:: Cabecera TCP ::.");
					printf("\n\nOffset: %d [bytes]\n", T[14 + TamIP + 12]>>4);
					printf("\nFlags: ");
					if((T[14 + TamIP + 13]&32))
						printf("\n\tU - URG   ");
					if((T[14 + TamIP + 13]&16))
						printf("\n\tA - ACK   ");
					if((T[14 + TamIP + 13]&8))
						printf("\n\tP - Push   ");
					if((T[14 + TamIP + 13]&4))
						printf("\n\tR - Reset   ");
					if((T[14 + TamIP + 13]&2))
						printf("\n\tS - Syn   ");
					if((T[14 + TamIP + 13]&1))
						printf("\n\tF - Finish");

					printf("\n\nChecksum: %.2x%.2x\n\n",T[14 + TamIP + 17],T[14 + TamIP + 18]);
					printf("Opciones:\n\n");

					if((14 + TamIP + TamTCP - 1) > (14 + TamIP + 19))
					{
						printf("%.2x\n", (T[14 + TamIP + 19 + 1]<<24) | (T[14 + TamIP + 19 + 2]<<16) | (T[14 + TamIP + 19 + 3]<<8) | (T[14 + TamIP + 19 + 4]));
					}

					return 0;
					break;
				case 17:
					printf("\n\n.:: Cabecera UDP ::.");
					/*printf("\n\nPuerto origen: %d ", T[14 + TamIP]<<8 | T[14 + TamIP + 1]);
					commonPort(T[14 + TamIP]<<8 | T[14 + TamIP + 1]);
					printf("\n\nPuerto destino: %d ", T[14 + TamIP + 2]<<8 | T[14 + TamIP + 3]);
					commonPort(T[14 + TamIP + 2]<<8 | T[14 + TamIP + 3]);
					printf("\n\nLargo: %d bytes", T[14 + TamIP + 4]<<8 | T[14 + TamIP + 5]);*/
					
						printf("\n\nCheksum: ");
						checkSUMud(T,14+TamIP);
						
						//printf("%.2 %.2\n", );
						//xd = checksumUDP(T,14+TamIP,14+TamIP+T[14 + TamIP + 4]<<8 | T[14 + TamIP + 5]-1);
						//printf("%04x\n", xd);
						//checkSUM(T,14+TamIP,14+TamIP+T[14 + TamIP + 4]<<8 | T[14 + TamIP + 5]-1, 14+TamIP+6,1);
					
				return 0;
				break;

				
			}
		}
		/*{
			printf("\n\n.:: Protocolo IP ::.");
			printf("\n\nVersion: %d", T[14]>>4);
			printf("\n\nTamanio de cabecera IP: %d bytes", (T[14]&15)*4);
			//printf("\n\nTipo de servicio: ");
			if(T[15]&16)
				printf("\n\nMinimo retardo");
			if(T[15]&8)
				printf("\n\nMAximizar todo");
			if(T[15]&4)
				printf("\n\nMaxima confiabilidad");
			if(T[15]&2)
				printf("\n\nMinimo costo");
			printf("\n\nLongitud total: %d",(T[16]<<8) | T[17]);
			printf("\n\nIdentificacion: %d", (T[18]<<8) | T[19]);
			printf("\n\nBanderas:");
			if(T[20]&64)
				printf("\n\n\tNo fragmentar");
			if(T[20]&32)
				printf("\n\n\tMas fragmentos\n\n");
				
			return 0;

		}*/
		
		else if(tot == 2054)
		{
			printf("\n\nTipo ARP");
			printf("\n\n.:: Cabecera ARP ::.");
			printf("\n\nTipo de direccion de Hardware: ");
			switch (T[15])
			{
				case 1: printf("Ethernet"); break;
				case 4: printf("Token Ring"); break;
				case 6: printf("IEEE 802 LAN"); break;
				case 15: printf("Frame Relay"); break;
				case 16: printf("ATM");break;
			}
			
			printf("\n\nMAC Origen: %.2x:%.2x:%.2x:%.2x:%.2x:%.2x",T[22],T[23],T[24],T[25],T[26],T[27]);
			printf("\n\nMAC Destino: %.2x:%.2x:%.2x:%.2x:%.2x:%.2x",T[28],T[29],T[30],T[31],T[32],T[33]);
			printf("\n\nIP Origen: %d.%d.%d.%d",T[38],T[39],T[40],T[41]);
			
			return 0;
		}
		
		else
		{	
			printf("\n\nTipo -OTRO-");
			printf("\n\n.:: Otro ::.");
		}
		
		printf("\n\nTipo de Trama: ");
		
		switch(T[16] & 3)
		{
			case 0: printf("Informacion");
					printf(", N(s) = %d, N(r) = %d, ",T[16]>>1,T[17]>>1);
					if(T[17] & 1)
					{
						if(T[15] & 1){printf("F");}
						else{printf("P");}
					}
					break;
			case 1: printf("Supervision, ");
					printf("%s, N(r) = %d , ",S[(T[16]>>2)&3],T[17]>>1);
					if(T[17] & 1)
					{
						if(T[15] & 1){printf("F");}
						else{printf("P");}
					}
					break;
			case 2: printf("Informacion");
					printf(", N(s) = %d, N(r) = %d, ",T[16]>>1,T[17]>>1);
					if(T[17] & 1)
					{
						if(T[15] & 1){printf("F");}
						else{printf("P");}
					}
					break;
			case 3:
				printf("No numerada");
				if(T[16]&16)
				{
					if(T[15]&1)//resp
						printf(", %s, F", UR[((T[16]>>2)&3) | ((T[16]>>3)&28)] );
					else
					{
						printf(", %s, P", UC[((T[16]>>2)&3) | ((T[16]>>3)&28)] );
					}
				}
				break;
			
		}
		
		
		
		printf("\n\n");
		return 0;
}
void checkSUM(unsigned char T[], unsigned short int iniT, unsigned short int finT, unsigned short int posXN
	, int chFlag){
	unsigned long int j, tCS=0;
	
	for(j=iniT;j<finT;j=j+2)
	{
		tCS=tCS+(T[j]<<8 | T[j+1] );
	}
	
	tCS=tCS-(T[posXN]<<8 | T[posXN+1]);

	if(chFlag==1)
	{
		tCS=0;
		for(j=iniT;j<finT;j=j+2){
				tCS=tCS+ (T[j]<<8 | T[j+1] );
		}
		tCS= ( (0<<8 | T[23]) + (T[26]<<8 | T[27]) + (T[28]<<8 | T[29]) + (T[30]<<8 | T[31])
		+ (T[32]<<8 | T[33]) + tCS  + (T[16]<<8 | T[17] ));
		tCS= ((tCS&65535) + (tCS>>16) );
		tCS= ~tCS;
		tCS= tCS & 65535;
		
		if (tCS == 65535) {
			printf("\n\nTrama correcta");
		} else {
			printf("\n\nTrama incorrecta");
			printf("\n\nCorrecto:");
			printf("%04x", tCS);
		}
		return;
	}

	tCS= ((tCS & 65535) + (tCS>>16) );
	tCS= ~tCS;
	tCS= tCS & 65535;
	
	printf("%04x", (T[posXN]<<8 | T[posXN+1]));
	if (tCS == (T[posXN]<<8 | T[posXN+1])) {
		printf("\n\nTrama correcta");
	} else {
		printf("\n\nTrama incorrecta");
		printf("\n\nCorrecto:");
		printf("%04x", tCS);
	}
}

void commonPort(unsigned short int portA){
	switch (portA) {
		case 7:
		printf(" - Echo");
		break;
		case 19:
		printf(" - Chargen");
		break;
		case 37:
		printf(" - Tiempo");
		break;
		case 53:
		printf(" - Dominio");
		break;
		case 67:
		printf(" - Bootps");
		break;
		case 68:
		printf(" - Bootpc");
		break;
		case 69:
		printf(" - Tftp");
		break;
		case 137:
		printf(" - Netbios-ns");
		break;
		case 138:
		printf(" - Netbios-dgm");
		break;
		case 161:
		printf(" - Snmp");
		break;
		case 162:
		printf(" - Snmp-trap");
		break;
		case 500:
		printf(" - Isakmp");
		break;
		case 514:
		printf(" - Syslog");
		break;
		case 520:
		printf(" - Rip");
		break;
		case 33434:
		printf(" - Tracerouts");
		break;
	}
}


void checkSUMud(unsigned char T[], unsigned short int iniT){
	unsigned long int CSUDP =0;
	CSUDP+=T[23];

	CSUDP+=(T[26]<<8|T[27]);
	CSUDP+=(T[28]<<8|T[29]);
	CSUDP+=(T[30]<<8|T[31]);
	CSUDP+=(T[32]<<8|T[33]);
	CSUDP+=(T[iniT+4]<<8|T[iniT+5]);
	int i;
	for(i=0;i<((T[iniT+4]<<8)|T[iniT + 5]);i+=2);{
		CSUDP+=(T[iniT+i]<<8)|T[iniT+i+1];
	}
	CSUDP-=(T[iniT+6]<<8)|T[iniT+7];
	while(CSUDP>>16){
		CSUDP =(CSUDP&0xFFFF)+(CSUDP>>16);
	}

	printf("%.4hx\n",~CSUDP);
	printf("%d\n",(T[iniT+6]<<8|T[iniT+7]|CSUDP));
	if(((T[iniT+6]<<8)|T[iniT+7]|CSUDP)>=60000){
	printf("Trama correcta :D \n");}
	else{
	printf("Trama incorrecta :'( \n");}
	
}